<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Pengu Adventure</title>
<style>
  body { margin:0; overflow:hidden; background:#87CEEB; }
  canvas { display:block; margin:0 auto; background:#87CEEB; }
  #controls { position: fixed; bottom: 20px; left:50%; transform:translateX(-50%); }
  .btn { width:60px; height:60px; margin:5px; border-radius:50%; font-size:24px; background:#fff; opacity:0.7; }
</style>
</head>
<body>

<canvas id="gameCanvas" width="800" height="500"></canvas>

<!-- Mobil dokunmatik kontroller -->
<div id="controls">
  <button class="btn" id="left">◀</button>
  <button class="btn" id="jump">⬆</button>
  <button class="btn" id="right">▶</button>
</div>

<script src="https://cdn.jsdelivr.net/npm/ethers@6.8.3/dist/ethers.min.js"></script>

<script>
// --------------------------
// OYUN DEĞİŞKENLERİ
// --------------------------
const canvas = document.getElementById('gameCanvas');
const ctx = canvas.getContext('2d');
let player = {x:40, y:400, w:50, h:50, vy:0, onGround:false};
let polly = {x:700, y:400, w:50, h:50};
let gravity = 0.8, speed = 5, jumpPower = -15;
let keys = {left:false, right:false, jump:false};
let gameWon = false;

// --------------------------
// GRAFİKLER (Sprite) YÜKLEME
// --------------------------
const penguImg = new Image();
penguImg.src = 'assets/pengu.png';
const pollyImg = new Image();
pollyImg.src = 'assets/polly.png';
const groundImg = new Image();
groundImg.src = 'assets/ground.png';
const bgImg = new Image();
bgImg.src = 'assets/bg.png';

// --------------------------
// KLAVYE KONTROLLERİ
// --------------------------
document.addEventListener('keydown', e=>{
  if(e.key==='ArrowLeft') keys.left=true;
  if(e.key==='ArrowRight') keys.right=true;
  if(e.key==='ArrowUp') keys.jump=true;
});
document.addEventListener('keyup', e=>{
  if(e.key==='ArrowLeft') keys.left=false;
  if(e.key==='ArrowRight') keys.right=false;
  if(e.key==='ArrowUp') keys.jump=false;
});

// --------------------------
// MOBİL BUTONLAR
// --------------------------
document.getElementById('left').addEventListener('touchstart',()=>keys.left=true);
document.getElementById('left').addEventListener('touchend',()=>keys.left=false);
document.getElementById('right').addEventListener('touchstart',()=>keys.right=true);
document.getElementById('right').addEventListener('touchend',()=>keys.right=false);
document.getElementById('jump').addEventListener('touchstart',()=>keys.jump=true);
document.getElementById('jump').addEventListener('touchend',()=>keys.jump=false);

// --------------------------
// OYUN DÖNGÜSÜ
// --------------------------
function update(){
  // Hareket
  if(keys.left) player.x -= speed;
  if(keys.right) player.x += speed;

  // Zıplama
  if(keys.jump && player.onGround){
    player.vy = jumpPower;
    player.onGround=false;
  }

  // Yerçekimi
  player.vy += gravity;
  player.y += player.vy;

  // Zemin
  if(player.y+player.h>=450){
    player.y=450-player.h;
    player.vy=0;
    player.onGround=true;
  }

  // Polly ile çarpışma
  if(!gameWon && player.x + player.w > polly.x && player.x < polly.x + polly.w &&
     player.y + player.h > polly.y && player.y < polly.y + polly.h){
    gameWon=true;
    alert('Tebrikler! Polly’i kurtardın. 1 PENGU token ödül kazandın!');
    // NFT ve token transfer fonksiyonları buraya entegre edilebilir
  }

  draw();
  requestAnimationFrame(update);
}

// --------------------------
// ÇİZİM FONKSİYONU
// --------------------------
function draw(){
  ctx.clearRect(0,0,canvas.width,canvas.height);
  // Arka plan
  ctx.drawImage(bgImg,0,0,canvas.width,canvas.height);
  // Zemin
  ctx.drawImage(groundImg,0,450,canvas.width,50);
  // Polly
  ctx.drawImage(pollyImg,polly.x,polly.y,polly.w,polly.h);
  // Player
  ctx.drawImage(penguImg,player.x,player.y,player.w,player.h);
}

// --------------------------
// BAŞLAT
// --------------------------
update();

// --------------------------
// Web3 / MetaMask bağlama (simülasyon)
// --------------------------
let provider, signer, userAddress;

async function connectWallet(){
  if(window.ethereum){
    provider = new ethers.BrowserProvider(window.ethereum);
    await provider.send("eth_requestAccounts", []);
    signer = await p
